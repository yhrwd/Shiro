import{R as fe,r as a,j as r}from"./index-DGsIptb-.js";import{c as _e,L as Te,u as ke}from"./image-Cm0-5JSV.js";import{c as he,a as M}from"./helper-CaAdfMs7.js";import{t as ge}from"./lodash-B3VVwmZe.js";import{l as pe,v as ve}from"./request-CfFCOyuS.js";import{a as F,b as te,c as ce}from"./toast-KWl-lBHu.js";import{c as Me}from"./StyledButton-ebbjU2OE.js";import{b as We}from"./viewport-CsuhZfWR.js";import{u as De,D as le}from"./use-is-unmounted-B3PvcIkW.js";import{a as Fe}from"./env-DbhK1WeT.js";const $e=({contexts:t,children:e})=>t.reduceRight((o,i)=>fe.cloneElement(i,{children:o}),e),q=typeof window<"u"?a.useLayoutEffect:a.useEffect,Be=F(!1),Ge=t=>pe.set(Be,t),xe=t=>{const e=(o,i=[])=>te(ve(t,a.useCallback(s=>o(s),i)));return e.__atom=t,e},ye=F(0),ne=F(null),Dt=({children:t})=>r.jsxs(r.Fragment,{children:[r.jsx(Ue,{}),t]}),Ue=()=>{const t=ce(ye),e=ce(ne),o=a.useRef(0),i=a.useRef(!1);return q(()=>{const s=ge(()=>{i.current||(Ge(!0),i.current=!0);const d=document.documentElement.scrollTop;e(o.current-d>0?"up":"down"),o.current=d,t(o.current)},16,{leading:!1});return window.addEventListener("scroll",s),s(),()=>{window.removeEventListener("scroll",s)}},[]),null},Ye=()=>te(ne),Ft=xe(ye);xe(ne);const ee=t=>{const e=a.useRef(t);return a.useEffect(()=>{e.current=t},[t]),e},qe=t=>{const e=a.useRef();return e.current||(e.current=t()),e.current},ze=a.createContext(F([])),$t=({children:t,images:e})=>{const o=qe(()=>F(e));return a.useEffect(()=>{pe.set(o,e)},[e]),r.jsx(ze.Provider,{value:o,children:t})},oe=t=>te(ve(a.useContext(ze),a.useCallback(e=>e.find(o=>o.src===t),[t]))),Ze=()=>{};function Z(t){const e=a.createContext(t),o=a.createContext(Ze);return[i=>{let{children:s}=i;const[d,g]=a.useState(t);return r.jsx(e.Provider,{value:d,children:r.jsx(o.Provider,{value:g,children:s})})},()=>a.useContext(e),()=>a.useContext(o),e]}const[Ve,Xe,Ke]=Z(void 0),[Qe,Je,et]=Z({h:0,w:0}),[tt,Bt,nt]=Z({x:0,y:0}),[ot,Gt,rt]=Z(!1),at=[r.jsx(Ve,{},"ArticleElementProviderInternal"),r.jsx(Qe,{},"ElementSizeProviderInternal"),r.jsx(tt,{},"ElementPositionProviderInternal"),r.jsx(ot,{},"IsEOArticleElementProviderInternal")],Ut=({children:t,className:e,...o})=>r.jsxs($e,{contexts:at,children:[r.jsx(it,{}),r.jsx(Ee,{...o,className:e,children:t})]}),it=()=>{const t=et(),e=nt(),o=Xe();return q(()=>{if(!o)return;const{height:i,width:s,x:d,y:g}=o.getBoundingClientRect();t({h:i,w:s}),e({x:d,y:g});const m=new ResizeObserver(E=>{const y=E[0],{height:p,width:L,x:N,y:A}=y.contentRect;t({h:p,w:L}),e({x:N,y:A})});return m.observe(o),()=>{m.unobserve(o),m.disconnect()}},[o]),null},Ee=a.memo(({children:t,className:e,eoaDetect:o,as:i="div"})=>{const s=Ke(),d=i;return r.jsxs(d,{className:he("relative",e),ref:s,children:[t,o&&r.jsx(st,{})]})});Ee.displayName="ArticleElementProviderContent";const st=()=>{const t=Ye(),e=ee(t),o=rt(),i=a.useRef(null);return a.useEffect(()=>{if(!i.current)return;const s=i.current,d=new IntersectionObserver(g=>{const m=g[0];!m.isIntersecting&&e.current==="down"||o(m.isIntersecting)},{rootMargin:"0px 0px 0px 0px"});return d.observe(s),()=>{d.unobserve(s),d.disconnect()}},[]),r.jsx("div",{ref:i})};/*! medium-zoom 1.1.0 | MIT License | https://github.com/francoischalifour/medium-zoom */var H=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},G=function(e){return e.tagName==="IMG"},ct=function(e){return NodeList.prototype.isPrototypeOf(e)},U=function(e){return e&&e.nodeType===1},de=function(e){var o=e.currentSrc||e.src;return o.substr(-4).toLowerCase()===".svg"},ue=function(e){try{return Array.isArray(e)?e.filter(G):ct(e)?[].slice.call(e).filter(G):U(e)?[e].filter(G):typeof e=="string"?[].slice.call(document.querySelectorAll(e)).filter(G):[]}catch{throw new TypeError(`The provided selector is invalid.
Expects a CSS selector, a Node element, a NodeList or an array.
See: https://github.com/francoischalifour/medium-zoom`)}},lt=function(e){var o=document.createElement("div");return o.classList.add("medium-zoom-overlay"),o.style.background=e,o},dt=function(e){var o=e.getBoundingClientRect(),i=o.top,s=o.left,d=o.width,g=o.height,m=e.cloneNode(),E=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,y=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0;return m.removeAttribute("id"),m.style.position="absolute",m.style.top=i+E+"px",m.style.left=s+y+"px",m.style.width=d+"px",m.style.height=g+"px",m.style.transform="",m},k=function(e,o){var i=H({bubbles:!1,cancelable:!1,detail:void 0},o);if(typeof window.CustomEvent=="function")return new CustomEvent(e,i);var s=document.createEvent("CustomEvent");return s.initCustomEvent(e,i.bubbles,i.cancelable,i.detail),s},ut=function t(e){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=window.Promise||function(c){function l(){}c(l,l)},s=function(c){var l=c.target;if(l===$){w();return}z.indexOf(l)!==-1&&R({target:l})},d=function(){if(!(_||!n.original)){var c=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0;Math.abs(ie-c)>f.scrollOffset&&setTimeout(w,150)}},g=function(c){var l=c.key||c.keyCode;(l==="Escape"||l==="Esc"||l===27)&&w()},m=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=c;if(c.background&&($.style.background=c.background),c.container&&c.container instanceof Object&&(l.container=H({},f.container,c.container)),c.template){var h=U(c.template)?c.template:document.querySelector(c.template);l.template=h}return f=H({},f,l),z.forEach(function(x){x.dispatchEvent(k("medium-zoom:update",{detail:{zoom:b}}))}),b},E=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t(H({},f,c))},y=function(){for(var c=arguments.length,l=Array(c),h=0;h<c;h++)l[h]=arguments[h];var x=l.reduce(function(u,C){return[].concat(u,ue(C))},[]);return x.filter(function(u){return z.indexOf(u)===-1}).forEach(function(u){z.push(u),u.classList.add("medium-zoom-image")}),v.forEach(function(u){var C=u.type,O=u.listener,T=u.options;x.forEach(function(P){P.addEventListener(C,O,T)})}),b},p=function(){for(var c=arguments.length,l=Array(c),h=0;h<c;h++)l[h]=arguments[h];n.zoomed&&w();var x=l.length>0?l.reduce(function(u,C){return[].concat(u,ue(C))},[]):z;return x.forEach(function(u){u.classList.remove("medium-zoom-image"),u.dispatchEvent(k("medium-zoom:detach",{detail:{zoom:b}}))}),z=z.filter(function(u){return x.indexOf(u)===-1}),b},L=function(c,l){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return z.forEach(function(x){x.addEventListener("medium-zoom:"+c,l,h)}),v.push({type:"medium-zoom:"+c,listener:l,options:h}),b},N=function(c,l){var h=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return z.forEach(function(x){x.removeEventListener("medium-zoom:"+c,l,h)}),v=v.filter(function(x){return!(x.type==="medium-zoom:"+c&&x.listener.toString()===l.toString())}),b},A=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=c.target,h=function(){var u={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight,left:0,top:0,right:0,bottom:0},C=void 0,O=void 0;if(f.container)if(f.container instanceof Object)u=H({},u,f.container),C=u.width-u.left-u.right-f.margin*2,O=u.height-u.top-u.bottom-f.margin*2;else{var T=U(f.container)?f.container:document.querySelector(f.container),P=T.getBoundingClientRect(),V=P.width,Ie=P.height,Ae=P.left,Se=P.top;u=H({},u,{width:V,height:Ie,left:Ae,top:Se})}C=C||u.width-f.margin*2,O=O||u.height-f.margin*2;var D=n.zoomedHd||n.original,Ce=de(D)?C:D.naturalWidth||C,je=de(D)?O:D.naturalHeight||O,B=D.getBoundingClientRect(),Le=B.top,Re=B.left,X=B.width,K=B.height,Oe=Math.min(Math.max(X,Ce),C)/X,Ne=Math.min(Math.max(K,je),O)/K,Q=Math.min(Oe,Ne),Pe=(-Re+(C-X)/2+f.margin+u.left)/Q,He=(-Le+(O-K)/2+f.margin+u.top)/Q,se="scale("+Q+") translate3d("+Pe+"px, "+He+"px, 0)";n.zoomed.style.transform=se,n.zoomedHd&&(n.zoomedHd.style.transform=se)};return new i(function(x){if(l&&z.indexOf(l)===-1){x(b);return}var u=function V(){_=!1,n.zoomed.removeEventListener("transitionend",V),n.original.dispatchEvent(k("medium-zoom:opened",{detail:{zoom:b}})),x(b)};if(n.zoomed){x(b);return}if(l)n.original=l;else if(z.length>0){var C=z;n.original=C[0]}else{x(b);return}if(n.original.dispatchEvent(k("medium-zoom:open",{detail:{zoom:b}})),ie=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,_=!0,n.zoomed=dt(n.original),document.body.appendChild($),f.template){var O=U(f.template)?f.template:document.querySelector(f.template);n.template=document.createElement("div"),n.template.appendChild(O.content.cloneNode(!0)),document.body.appendChild(n.template)}if(n.original.parentElement&&n.original.parentElement.tagName==="PICTURE"&&n.original.currentSrc&&(n.zoomed.src=n.original.currentSrc),document.body.appendChild(n.zoomed),window.requestAnimationFrame(function(){document.body.classList.add("medium-zoom--opened")}),n.original.classList.add("medium-zoom-image--hidden"),n.zoomed.classList.add("medium-zoom-image--opened"),n.zoomed.addEventListener("click",w),n.zoomed.addEventListener("transitionend",u),n.original.getAttribute("data-zoom-src")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("srcset"),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading"),n.zoomedHd.src=n.zoomed.getAttribute("data-zoom-src"),n.zoomedHd.onerror=function(){clearInterval(T),console.warn("Unable to reach the zoom image target "+n.zoomedHd.src),n.zoomedHd=null,h()};var T=setInterval(function(){n.zoomedHd.complete&&(clearInterval(T),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",w),document.body.appendChild(n.zoomedHd),h())},10)}else if(n.original.hasAttribute("srcset")){n.zoomedHd=n.zoomed.cloneNode(),n.zoomedHd.removeAttribute("sizes"),n.zoomedHd.removeAttribute("loading");var P=n.zoomedHd.addEventListener("load",function(){n.zoomedHd.removeEventListener("load",P),n.zoomedHd.classList.add("medium-zoom-image--opened"),n.zoomedHd.addEventListener("click",w),document.body.appendChild(n.zoomedHd),h()})}else h()})},w=function(){return new i(function(c){if(_||!n.original){c(b);return}var l=function h(){n.original.classList.remove("medium-zoom-image--hidden"),document.body.removeChild(n.zoomed),n.zoomedHd&&document.body.removeChild(n.zoomedHd),document.body.removeChild($),n.zoomed.classList.remove("medium-zoom-image--opened"),n.template&&document.body.removeChild(n.template),_=!1,n.zoomed.removeEventListener("transitionend",h),n.original.dispatchEvent(k("medium-zoom:closed",{detail:{zoom:b}})),n.original=null,n.zoomed=null,n.zoomedHd=null,n.template=null,c(b)};_=!0,document.body.classList.remove("medium-zoom--opened"),n.zoomed.style.transform="",n.zoomedHd&&(n.zoomedHd.style.transform=""),n.template&&(n.template.style.transition="opacity 150ms",n.template.style.opacity=0),n.original.dispatchEvent(k("medium-zoom:close",{detail:{zoom:b}})),n.zoomed.addEventListener("transitionend",l)})},R=function(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=c.target;return n.original?w():A({target:l})},W=function(){return f},I=function(){return z},j=function(){return n.original},z=[],v=[],_=!1,ie=0,f=o,n={original:null,zoomed:null,zoomedHd:null,template:null};Object.prototype.toString.call(e)==="[object Object]"?f=e:(e||typeof e=="string")&&y(e),f=H({margin:0,background:"#fff",scrollOffset:40,container:null,template:null},f);var $=lt(f.background);document.addEventListener("click",s),document.addEventListener("keyup",g),document.addEventListener("scroll",d),window.addEventListener("resize",w);var b={open:A,close:w,toggle:R,update:m,clone:E,attach:y,detach:p,on:L,off:N,getOptions:W,getImages:I,getZoomedImage:j};return b};function mt(t,e){e===void 0&&(e={});var o=e.insertAt;if(!(!t||typeof document>"u")){var i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("style");s.type="text/css",o==="top"&&i.firstChild?i.insertBefore(s,i.firstChild):i.appendChild(s),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(document.createTextNode(t))}}var ft=".medium-zoom-overlay{position:fixed;top:0;right:0;bottom:0;left:0;opacity:0;transition:opacity .3s;will-change:opacity}.medium-zoom--opened .medium-zoom-overlay{cursor:pointer;cursor:zoom-out;opacity:1}.medium-zoom-image{cursor:pointer;cursor:zoom-in;transition:transform .3s cubic-bezier(.2,0,.2,1)!important}.medium-zoom-image--hidden{visibility:hidden}.medium-zoom-image--opened{position:relative;cursor:pointer;cursor:zoom-out;will-change:transform}";mt(ft);const ht=t=>fe.createElement("img",t,t.children),gt="_error_hef56_1",pt="_loading_hef56_2",vt="_loaded_hef56_6",xt="_imageLoad_hef56_1",me={error:gt,loading:pt,loaded:vt,imageLoad:xt},re=Me({base:"rounded-xl overflow-hidden text-center inline-flex items-center justify-center duration-200",variants:{status:{loading:"hidden opacity-0",loaded:"opacity-100 block",error:"hidden opacity-0"}}});let J;const yt=({alt:t,src:e,title:o,zoom:i,placeholder:s,height:d,width:g,className:m})=>{const[E]=a.useState(()=>{if(Fe)return null;if(J)return J;const v=ut(void 0,{});return J=v,v}),y=o||t,[p,L]=a.useState("loading"),N=De(),A=a.useCallback(v=>{N.current||L(v)},[N]),w=a.useRef(null),R=We();q(()=>{if(p!=="loaded"||!i)return;const v=w.current;if(v){if(R)return v.onclick=()=>{window.open(e)},()=>{v.onclick=null};if(v)return E.attach(v),()=>{E.detach(v)}}},[i,E,p,R]);const W=a.useCallback(()=>{A("loaded")},[A]),I=a.useCallback(()=>A("error"),[A]),j=a.useCallback(v=>{v.target.classList.remove(me.loaded)},[]),z=a.useMemo(()=>re({status:p,className:M(me.loaded,m)}),[m,p]);return r.jsxs("figure",{children:[r.jsx("span",{className:"relative flex justify-center","data-hide-print":!0,children:r.jsxs(Te,{placeholder:s,offset:30,children:[r.jsx("span",{children:p!=="loaded"&&s}),p==="error"&&r.jsxs("div",{className:"absolute inset-0 z-[1] flex flex-col gap-8 center",children:[r.jsx("i",{className:"icon-[mingcute--close-line] text-4xl text-red-500"}),r.jsx("span",{children:"图片加载失败"}),r.jsx(le,{className:"w-[80px] opacity-80"}),r.jsx("a",{href:e,target:"_blank",rel:"noreferrer",children:r.jsx("span",{children:"查看原图"})})]}),r.jsx(be,{height:d,width:g,src:e,title:o,alt:t||o||"",ref:w,onLoad:W,onError:I,className:z,onAnimationEnd:j})]})}),r.jsx("img",{className:"max-w-1/3 !hidden print:!block",src:e,alt:t||o}),!!y&&r.jsxs("figcaption",{className:"mt-1 flex flex-col items-center justify-center",children:[r.jsx(le,{className:"w-[80px] opacity-80"}),r.jsx("span",{children:y})]})]})},zt=t=>{const e=a.useMemo(()=>r.jsx(Et,{...t}),[t]);return r.jsx(yt,{zoom:!0,placeholder:e,...t})},Et=({src:t,containerWidth:e,height:o,width:i,accent:s})=>{const d=oe(t),g=s||d?.accent,m=a.useMemo(()=>{let E=o,y=i;if(!E||!y){if(!d)return;E=d.height,y=d.width}if(e<=0)return;const{height:p,width:L}=_e({width:y,height:E,max:{width:e,height:1/0}});return{scaleHeight:p,scaleWidth:L}},[o,i,e,d]);return m?r.jsx("span",{className:`image-placeholder ${re.base}`,"data-width":m.scaleWidth,"data-height":m.scaleHeight,"data-from-record-height":d?.height,"data-from-record-width":d?.width,"data-src":t,style:{height:m.scaleHeight,width:m.scaleWidth,backgroundColor:g}}):r.jsx(bt,{accent:g})},bt=({accent:t})=>r.jsx("span",{className:he("image-placeholder",re.base,"h-[300px] w-full bg-slate-300 dark:bg-slate-700"),style:{backgroundColor:t,outline:void 0}}),be=a.memo(a.forwardRef(({src:t,alt:e,...o},i)=>{const{height:s,width:d}=oe(t)||o,g=!!(s&&d),m=a.useRef(null),E=r.jsx("img",{"data-zoom-src":t,alt:e,src:t,ref:m,...o});a.useImperativeHandle(i,()=>m.current);const y=a.useRef(null);return q(()=>{const p=y.current;p&&m.current&&(m.current.src=p.src)},[t]),r.jsx(r.Fragment,{children:g?r.jsxs(r.Fragment,{children:[r.jsx(ht,{alt:e||"",fetchPriority:"high",priority:!0,src:t,...o,height:+s,width:+d,ref:y}),r.jsx("div",{className:"absolute inset-0 flex justify-center opacity-0",children:a.cloneElement(E,{src:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"})})]}):E})}));be.displayName="OptimizedImage";const wt="_root_1ug9l_1",It="_indicator_1ug9l_2",At="_container_1ug9l_7",St="_child_1ug9l_17",Y={root:wt,indicator:It,container:At,child:St},ae=60,Ct=15,jt=5e3,Yt=t=>{const{images:e}=t,[o,i]=a.useState(null),[,s]=a.useState({}),d=a.useRef(0);a.useEffect(()=>{if(!o)return;const I=new ResizeObserver(()=>{s({}),j(o)});function j(z){const v=z.children.item(0);v&&(d.current=v.clientWidth)}return j(o),I.observe(o),()=>{I.disconnect()}},[o]);const[g,m]=a.useState(0),E=a.useCallback(ge(I=>{const j=I.target,z=Math.floor((j.scrollLeft+ae+15)/d.current);m(z)},60),[]),y=a.useCallback(I=>{o&&o.scrollTo({left:d.current*I,behavior:"smooth"})},[o]),p=a.useRef(null),L=ee(g),N=ee(e.length),A=a.useRef(!0),w=a.useRef(!0),R=a.useCallback(()=>{w.current&&(w.current=!1,clearInterval(p.current))},[]),{ref:W}=ke({initialInView:!1,triggerOnce:e.length<2,onChange(I){N.current<2||!w.current||(I?p.current=setInterval(()=>{L.current+1>N.current-1&&A.current&&(A.current=!1),L.current-1<0&&!A.current&&(A.current=!0);const j=L.current+(A.current?1:-1);y(j)},jt):p.current=clearInterval(p.current))}});return a.useEffect(()=>()=>{clearInterval(p.current)},[]),r.jsxs("div",{className:M("w-full","relative",Y.root),ref:W,onTouchMove:R,onWheel:R,children:[r.jsx("div",{className:M("w-full overflow-auto whitespace-nowrap",Y.container),onTouchStart:R,onScroll:E,ref:i,onTouchMove:R,onWheel:R,children:e.map(I=>r.jsx(we,{image:I},I.url))}),r.jsx("div",{className:M(Y.indicator,"space-x-2"),children:Array.from({length:e.length}).map((I,j)=>r.jsx("div",{className:M("size-[6px] cursor-pointer rounded-full bg-stone-600 opacity-50 transition-opacity duration-200 ease-in-out",g==j&&"!opacity-100"),onClick:y.bind(null,j)},j))})]})},Lt={width:`calc(100% - ${ae}px)`,marginRight:`${Ct}px`},we=a.memo(({image:t})=>{const e=oe(t.url),o=t.name,s=t.footnote||(["!","¡"].some(g=>g==o?.[0])?o?.slice(1):"")||"",{w:d}=Je();return r.jsx("div",{style:Lt,className:M(Y.child,"inline-block self-center"),children:r.jsx(zt,{accent:e?.accent,src:t.url,alt:s,containerWidth:d-ae})},`${t.url}-${t.name||""}`)});we.displayName="GalleryItem";export{zt as F,Yt as G,ht as I,$t as M,$e as P,Ut as W,oe as a,qe as b,Bt as c,Ft as d,q as e,Dt as f,ut as m,Je as u};
